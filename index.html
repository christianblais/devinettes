<!DOCTYPE html>
  <head>
    <title>Devine mon Québec</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --color-accent: #4F98E3;
        --color-subdued: #B3D4F5;
        --color-background: #F2F7FD;
      }

      html, body {
        height: 100%;
        padding: 0;
        margin: 0;
      }

      @keyframes slidein {
        from {
          transform: rotate(-45deg);
          translate: 150vw -50%;
        }

        to {
          transform: rotate(0deg);
          translate: -50% -50%;
        }
      }

      @keyframes slideout {
        from {
          transform: rotate(0deg);
          translate: -50% -50%;
        }

        to {
          transform: rotate(-120deg);
          translate: -150vw -50%;
          filter: grayscale(50%);
        }
      }

      my-app {
        background-color: #F2F7FD;
        text-align: center;
        font-family: Verdana, Arial, Helvetica, sans-serif;
        min-height: 100%;
        display: grid;
        grid-template-rows: auto 1fr auto auto;
        gap: 1em;
        padding: 0;
        margin: 0;

        header {
          h1 {
            color: var(--color-accent);
            margin: 40px 0;
          }
        }

        footer {
          color: var(--color-subdued);
        }

        #deck {
          position: relative;
          width: 100vw;
          height: 100%;
          overflow: hidden;

          .card {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translateX(-50%) translateY(-50%);
            width: calc(100% - 20px);
            max-width: 500px;
            height: 100%;
            max-height: 300px;
            display: block;
            font-size: 2em;
            perspective: 500px;
            cursor: pointer;
            animation-duration: 0.5s;
            animation-name: slidein;

            &.removed {
              animation-duration: 0.5s;
              animation-name: slideout;
            }

            .card-content {
              position: absolute;
              width: 100%;
              height: 100%;
              box-shadow: 0 0 15px rgba(0,0,0,0.2);
              transition: transform 0.5s;
              transform-style: preserve-3d;

              p {
                position: absolute;
                width: calc(100% - 60px);
                top: 50%;
                left: 30px;
                transform: translateY(-50%);
                padding: 0;
                margin: 0;
                text-align: center;
              }

              .icon {
                position: absolute;
                bottom: 20px;
                right: 20px;
                font-size: 0.5em;
              }

              .card-content-side-a,
              .card-content-side-b {
                position: absolute;
                height: 100%;
                width: 100%;
                text-align: center;
                border-radius: 5px;
                backface-visibility: hidden;
              }

              .card-content-side-a {
                color: var(--color-background);
                background-color: var(--color-accent);
              }

              .card-content-side-b {
                color: var(--color-accent);
                background-color: var(--color-subdued);
                transform: rotateY(180deg);
              }
            }

            &.reveal {
              .card-content {
                transform: rotateY(180deg);
                transition: transform 0.5s;
              }
            }
          }
        }

        .button-group {
          button {
            color: var(--color-background);
            background-color: var(--color-accent);
            display: inline-block;
            padding: 12px 24px;
            border-width: 0;
            border-radius: 5px;
            font-size: 1.2em;
            cursor: pointer;
            touch-action: manipulation;
            bottom: 0;
          }

          button:active {
            background-color: var(--color-subdued);
          }
        }
      }
    </style>

    <script>
      /**
       * @returns A new randomized array
       */
      Array.prototype.toShuffled = function() {
        const array = [...this];

        for (let i = array.length - 1; i > 0; i--) {
          const rand = Math.floor(Math.random() * (i + 1));
          [array[i], array[rand]] = [array[rand], array[i]];
        }

        return array;
      }

      window.dictionary = [
        [`Argenteuil`, `Dollar, Yeux`],
        [`Arvida`, `Elle enleva le contenu une deuxième fois`],
        [`Beaupré`, `Joli champs`],
        [`Beaconsfield`, `Champs anglophone de jambon`],
        [`Bécancour`, `Bouche d'oiseau, douze mois, marche vite`],
        [`Bellechasse`, `Jolie poursuite`],
        [`Belleterre`, `Jolie planète`],
        [`Beloeil`, `Joli globe oculaire`],
        [`Boisbriand`, `Forêt lumineuse`],
        [`Bonaventure`, `Péripétie agréable`],
        [`Boucherville`, `Agglomération des débiteurs de viande`],
        [`Bromont`, `Dude, Colline`],
        [`Cap-Chat`, `Péninsule qui n'est pas un chien`],
        [`Cap-Santé`, `Péninsule qui n'est pas malade`],
        [`Charlemagne`, `Roi des francs`],
        [`Châteauguay`, `Palais homosexuel`],
        [`Coaticook`, `Raton d'amérique centrale qui cuisine en anglais`],
        [`Contrecoeur`, `À l'envers d'un organe`],
        [`Contrecoeur`, `Malgré soi`],
        [`Deux-Montagnes`, `Moins que trois grosses collines`],
        [`Drummondville`, `Instrument de percussion sur la cité`],
        [`Escoumins`, `Pluriel, tient la tête, au bout des bras`],
        [`Etchemins`, `(Les) Liaison, sentiers`],
        [`Fermont`, `Montagne de métaux magnétique`],
        [`Forestville`, `Agglomération dans le bois anglophone`],
        [`Havre-Saint-Pierre`, `Port de l'apôtre`],
        [`Issoudun`, `Il lie métaliquement un [...]`],
        [`Joliette`, `Petite beauté`],
        [`Jonquière`, `Anneau, pronom relatif, avant aujourd'hui`],
        [`Kamouraska`, `Qu'un sentiment à danse jamaïcaine`],
        [`L'Ancienne-Lorette`, `Très vieille lorette`],
        [`Lac-Sergent`, `Étendue d'eau militaire`],
        [`Lachine`, `L'Empire du Milieu`],
        [`Lachute`, `La débâcle`],
        [`La Tuque`, `Le chapeau qui tient au chaud`],
        [`Longueuil`, `Globe oculaire étiré`],
        [`Malartic`, `Douloureux pôle`],
        [`Métis-sur-Mer`, `Autochtone à l'océan`],
        [`Mingan`, `Une partie du corps et son vêtement`],
        [`Mirabel`, `Au centre du pain, plus gros qu'une souris, joli`],
        [`Mont-Royal`, `Colline de sa majesté`],
        [`Mont-Tremblant`, `Colline qui frissonne`],
        [`Neuville`, `Municipalité récente`],
        [`Notre-Dame-des-Prairies`, `Vierge des champs`],
        [`Notre-Dame-du-Portage`, `Vierge du transport`],
        [`Percé`, `Troué`],
        [`Pincourt`, `Petit conifère`],
        [`Pont-Rouge`, `Arche colorée`],
        [`Portneuf`, `Marina récente`],
        [`Québec`, `Plate-forme marine bisou`],
        [`Richelieu`, `Emplacement pas pauvre du tout`],
        [`Rivière-du-Loup`, `Cours d'eau appartenant au canin`],
        [`Rouyn`, `Pneu, quoi?`],
        [`Saint-Hilarion`, `Rieur béni chargé positivement ou négativement`],
        [`Sept-Île`, `Est-ce qu'il connaît?`],
        [`Sherbrooke`, `Dispendieux, ruisseau anglophone`],
        [`Tadousac`, `Pile soyeuse emballée`],
        [`Trois-Rivière`, `Moins de quatre cours d'eau`],
        [`Yamachiche`, `Il détient une chiche qui m'appartient`],
        [`Yamaska`, `Il détient mon style musical d'origine Jamaïquaine`],
      ];

      class MyApp extends HTMLElement {
        constructor() {
          super();

          this.dictionary = window.dictionary.toShuffled();
          this.currentIdx = 0;
        }

        connectedCallback() {
          this.$deck = this.querySelector('#deck');
          this.$tmpl = this.querySelector('#card');

          this.querySelector('#next').addEventListener('click', this.next.bind(this));
          this.querySelector('#back').addEventListener('click', this.back.bind(this));

          window.addEventListener('keydown', (event) => {
            // right arrow
            if (event.keyCode === 39) {
              this.next();
            }

            // left arrow
            if (event.keyCode === 37) {
              this.back();
            }

            // spacebar
            if (event.keyCode === 32) {
              event.preventDefault();
              this.flip();
            }
          });

          // Start the game by initializing a first item
          this.setItem(this.dictionary[this.currentIdx]);
        }

        flip(onFlipCompletionCallback) {
          if (onFlipCompletionCallback) {
            this.$card.addEventListener('transitionend', onFlipCompletionCallback, { once: true });
          }

          if (this.$card.classList.contains('reveal')) {
            this.$card.classList.remove('reveal');
          } else {
            this.$card.classList.add('reveal');
          }
        }

        setItem(item) {
          if (this.$card) {
            this.$card.addEventListener('animationend', (e) => e.target.remove(), { once: true });
            this.$card.classList.add('removed');
          }

          const newCard = this.$tmpl.cloneNode(true).content;

          newCard.querySelector('slot[name=card-content-side-a-text]').replaceWith(item[1]);
          newCard.querySelector('slot[name=card-content-side-b-text]').replaceWith(item[0]);

          this.$deck.appendChild(newCard);

          this.$card = this.$deck.lastElementChild;
          this.$card.addEventListener('click', this.flip.bind(this));
        }

        next() {
          if (this.dictionary.length > this.currentIdx + 1) {
            this.setItem(this.dictionary[++this.currentIdx]);
          }
        }

        back() {
          if (this.currentIdx > 0) {
            this.setItem(this.dictionary[--this.currentIdx]);
          }
        }
      }
    </script>
  </head>
  <body>
    <my-app>
      <header>
        <h1>De quel lieu québécois s'agit-il?</h1>
      </header>

      <div id="deck">
        <template id="card">
          <div class="card">
            <div class="card-content">
              <div class="card-content-side-a">
                <p><slot name="card-content-side-a-text"></slot></p>
                <i class="icon">⤴</i>
              </div>
              <div class="card-content-side-b">
                <p><slot name="card-content-side-b-text"></slot></p>
                <i class="icon">⤴</i>
              </div>
            </div>
          </div>
        </template>
      </div>

      <div class="button-group">
        <button id="back">
          Précédent
        </button>
        <button id="next">
          Suivant
        </button>
      </div>

      <footer>
        <p><small>Fait avec ❤️ par Christian Blais</small></p>
      </footer>
    </my-app>

    <script>
      window.customElements.define('my-app', MyApp);
    </script>
  </body>
</html>
